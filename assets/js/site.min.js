import domlib from"/js/domlib.min.js";const app=domlib.emitter(),d=app.d=domlib,df=domlib.domfn,{div:div,article:article,textarea:textarea,input:input,a:a,p:p,button:button,hr:hr,h1:h1,h4:h4,section:section,span:span,header:header}=df,{txt:txt}=d,reqWithBody=(t="application/json",e=JSON.stringify)=>a=>(n,o,i={})=>fetch(n,{method:a,headers:{"Content-Type":t},body:e(o),...i}),jsonHTTPMethod=reqWithBody(),textHTTPMethod=reqWithBody("text/plain",t=>t);app.jsonPost=jsonHTTPMethod("POST"),app.jsonPut=jsonHTTPMethod("PUT"),app.jsonDelete=jsonHTTPMethod("DELETE"),app.txtPost=textHTTPMethod("POST"),app.txtPut=textHTTPMethod("PUT"),app.txtDelete=textHTTPMethod("DELETE");const wq=t=>async(e={})=>{isNaN(e.page)&&(e.page=0),e.kind||(e.kind="post");const a=await app.jsonPost(t,e);return await a.json()};app.writQuery=wq("/writs"),app.editableWritQuery=wq("/editable-writs"),app.toggleSituations={list:[],active:null},app.setupToggleSituation=(t,e,a="body",{viewOutAnimation:n,delayRemoveMS:o,background:i}={})=>{const s={};return s.clickOutHandler=d.on.pointerdown(document.body,a=>{if(a.target!=e&&!e.contains(a.target)&&df.hasClass(e,"open")&&a.target!=t){if(a.path.some(t=>t instanceof Element&&t.classList.contains("toast")))return;a.preventDefault(),s.toggleView(!1),s.clickOutHandler.off()}}).off(),s.launchEventHandler=d.on.pointerdown(t,t=>{t.preventDefault(),s.toggleView()}),!0===i&&(i=div.background_cover()),s.toggleView=(p=!df.hasClass(e,"open"))=>{df.class(e,"open",p),df.class(t,"active",p),p?(i&&d.render(i),d.render(e,a),s.clickOutHandler.on(),app.toggleSituations.active&&app.toggleSituations.active.toggleView(!1),app.toggleSituations.active=s):(app.toggleSituations.active==s&&(app.toggleSituations.active=null),null!=o?(e.style.animation=n,s.launchEventHandler.off(),df.remove(e,o).then(()=>{i&&df.remove(i),e.style.animation="",s.launchEventHandler.on()})):(i&&df.remove(i),df.remove(e)))},app.toggleSituations.list.push(s),s},app.loadScriptsThenRunSequentially=(t,...e)=>new Promise(async(a,n)=>{const o=setTimeout(n,3e3*e.length),i=e[e.length-1];let s="";if(t&&i in localStorage)s=localStorage.getItem(i);else{const a={},n=[];for(const t of e)n.push(fetch(t).then(t=>t.text()).then(e=>{a[t]=e}));await Promise.all(n);for(const t in a)s+="\n;"+a[t];s+=`\n; app.emit("doneLoading:${i}");`,t&&localStorage.setItem(i,s)}app.once["doneLoading:"+i](a),df.script({$:document.head},s),clearTimeout(o)}),app.loadStyle=async(t,e)=>{let a;e&&t in localStorage?a=localStorage.getItem(t):(a=await(await fetch(t)).text(),e&&localStorage.setItem(t,a)),df.style({$:document.head},a)};const abreviateNum_units=["k","M","G","T","P","E","Z","Y"];app.abreviateNum=(t,e)=>{for(let a,n=abreviateNum_units.length-1;n>=0;n--)if(a=Math.pow(1e3,n+1),t<=-a||t>=a)return+(t/a).toFixed(e)+abreviateNum_units[n];return t},app.components={},app.components.toggleBox=(t,{id:e,checked:a,...n}={})=>div.togglebox(o=>o.input=input(d.merge({attr:{name:t,id:e,checked:a,type:"checkbox"}},n)),span()),domlib.createElementPlugins.contingentVisibility=(t,e)=>{if(domlib.isArr(t))var[t,a]=t;domlib.isStr(t)&&app.on["cv:"+t](t=>{t?e.removeAttribute("hidden"):e.setAttribute("hidden",!0),domlib.isFunc(a)&&a(t)})},app.dismissIcon=()=>domlib.html('<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 22px;">\n<polygon fill="rgb(255, 66, 66)" points="11.649 9.882 18.262 3.267 16.495 1.5 9.881 8.114 3.267 1.5 1.5 3.267 8.114 9.883 1.5 16.497 3.267 18.264 9.881 11.65 16.495 18.264 18.262 16.497">\n</polygon>\n</svg>'),app.cv=(t,e)=>{if(app.cv.map[t]==e)return!1;void 0===e&&(e=!app.cv.map[t]),app.emit["cv:"+t](app.cv.map[t]=!!e)},app.cv.check=t=>!!app.cv.map[t],app.cv.map=Object.create(null),app.toastContainer=section.toast_container({$:"body",contingentVisibility:"gotToast"}),app.cv("gotToast",!1),app.toastList=new Set,app.toast=new Proxy((t,e,a=15e3)=>{app.cv("gotToast",!0);const n=()=>{df.remove(o),app.toastList.delete(o),0==app.toastList.size&&app.cv("gotToast",!1)},o=div.toast[t]({$:app.toastContainer},span(e),span.dismiss_btn({onceclick(){n()}},app.dismissIcon()));return app.toastList.add(o),df.remove(o,a).then(n),o},{get:(t,e)=>t.bind(null,e)}),d.run(async()=>{try{await app.loadScriptsThenRunSequentially(!0,"https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.36/dayjs.min.js","https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.36/plugin/utc.min.js","https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.36/plugin/relativeTime.min.js"),window.dayjs.extend(window.dayjs_plugin_utc),window.dayjs.extend(window.dayjs_plugin_relativeTime),dayjs().utcOffset(2),app.emit("dayjsLoaded",app.dayjsLoaded=!0)}catch(t){}}),app.dateFormat="HH:mm a DD MMM YYYY",app.dayjsUXTSformat=t=>{const e=dayjs.unix(t).utcOffset(2);return e.format(app.dateFormat)+" | "+e.fromNow()},app.renderUXTimestamp=(t,e=app.dayjsUXTSformat,a)=>{null==a&&(a=d.txt());try{a.textContent=e(t),(a.textContent.includes("minute")||a.textContent.includes("hour"))&&(a.updateInterval=setInterval((function n(){a.textContent=e(t),document.contains(a)?a.textContent.includes("hour")&&(clearInterval(a.updateInterval),a.updateInterval=setInterval(n,36e5)):clearInterval(a.updateInterval)}),6e4))}catch(n){a.textContent=new Date(1e3*t).toLocaleString(),app.once.dayjsLoaded(()=>app.renderUXTimestamp(t,e,a))}return a},app.vote=async(t,e,a)=>{try{const n=await fetch(`/${t}/${e}/${null==a?"unvote":a?"upvote":"downvote"}`);return await n.json()}catch(t){console.error("app.voteWrit error: ",t)}return!1},app.formatVoteCount=(t,e,a=2)=>{t.innerHTML="";let n=app.abreviateNum(e,a);if("string"==typeof n&&n.includes(".")){const t=n[n.length-1];n=n.substring(0,n.length-1);const[e,a]=n.split(".");n=[span(e),".",span.endbits(a),span.marker(t)]}d.render(n,t)},app.votesUI=(t,{id:e,vote:a=0,you_voted:n})=>o=>{const i=div.votes({async onclick(o,i){if(null==app.user){o.preventDefault(),app.oneTimeAuthLauncher&&app.oneTimeAuthLauncher.off();try{app.authViewToggle?app.authViewToggle.toggleView():await import("/js/auth.min.js")}catch(o){app.oneTimeAuthLauncher&&app.oneTimeAuthLauncher.on()}return}const s=o.target.classList.contains("up"),p=o.target.classList.contains("down");if(!p&&!s)return;o.target.classList.add("await-vote"),clearInterval(i.awaitAnimTimeout),i.awaitAnimTimeout=setTimeout(()=>{o.target.classList.remove("await-vote")},2500);const r=o.target.classList.contains("selected");if(null!=n&&r){const s=await app.vote(t,e);clearInterval(i.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=s&&(i.downvote.classList.remove("selected"),i.upvote.classList.remove("selected"),app.formatVoteCount(i.voteCount,a=s.data),n=null)}else if(s){const s=await app.vote(t,e,!0);clearInterval(i.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=s&&(i.downvote.classList.remove("selected"),i.upvote.classList.add("selected"),app.formatVoteCount(i.voteCount,a=s.data),n=!0)}else if(p){const s=await app.vote(t,e,!1);clearInterval(i.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=s&&(i.upvote.classList.remove("selected"),i.downvote.classList.add("selected"),app.formatVoteCount(i.voteCount,a=s.data),n=!1)}}});return i.append(i.upvote=span({class:{up:!0,vote:!0,selected:!0===n,"icon-up-open":!0}}),i.voteCount=span.vote_count(a),i.downvote=span({class:{down:!0,vote:!0,selected:!1===n,"icon-down-open":!0}})),i},app.tabView=({$:t,tabs:e=[],attacher:a="after",...n})=>{const o=header({onclick(t){t.target.classList.contains("tab-name")&&!t.target.classList.contains("active")&&s&&(s.name.classList.remove("active"),s=i[t.target.textContent],s.name.classList.add("active"),p.innerHTML="",d.render(s.view,p))}}),i=Object.create(null);e.map(({name:t,view:e})=>{i[t]={name:div.tab_name(t),view:e},o.append(i[t].name)});let s=i[e[0].name];s.name.classList.add("active");const p=div(s.view),r=article.tab_view(n,o,p);return t&&d.render(r,t,a),{element:r,get tabs(){return e},get views(){return i},add(t,a){e.push({name:t,view:a}),i[t]={name:div.tab_name({$:o},t),view:a}},remove(t){e=e.filter(e=>e.name!=t),df.remove(i[t].name),delete i[t]},set active(t){i[t]&&(s.name.classList.remove("active"),s=i[t],s.name.classList.add("active"),p.innerHTML="",d.render(s.view,p))},get active(){return s}}},window.app=app;export default app;
//# sourceMappingURL=site.min.js.map