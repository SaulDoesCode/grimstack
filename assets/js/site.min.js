import d from"/js/domlib.min.js";const app=d.emitter({d:d}),df=d.domfn,{div:div,article:article,textarea:textarea,input:input,a:a,p:p,button:button,hr:hr,h1:h1,h4:h4,section:section,span:span,header:header}=df,reqWithBody=(t="application/json",e=JSON.stringify)=>a=>(n,o,s={})=>fetch(n,{method:a,headers:{"Content-Type":t},body:e(o),...s}),jsonHTTPMethod=reqWithBody(),textHTTPMethod=reqWithBody("text/plain",t=>t);app.jsonPost=jsonHTTPMethod("POST"),app.jsonPut=jsonHTTPMethod("PUT"),app.jsonDelete=jsonHTTPMethod("DELETE"),app.txtPost=textHTTPMethod("POST"),app.txtPut=textHTTPMethod("PUT"),app.txtDelete=textHTTPMethod("DELETE");const wq=t=>async(e={})=>{isNaN(e.page)&&(e.page=0),e.kind||(e.kind="post");const a=await app.jsonPost(t,e);return await a.json()};app.writQuery=wq("/writs"),app.editableWritQuery=wq("/editable-writs"),app.toggleSituations={list:[],active:null},app.setupToggleSituation=(t,e,a="body",{viewOutAnimation:n,delayRemoveMS:o,background:s}={})=>{const i={};return i.clickOutHandler=d.on.pointerdown(document.body,a=>{if(a.target!=e&&!e.contains(a.target)&&df.hasClass(e,"open")&&a.target!=t){if(a.path.some(t=>t instanceof Element&&t.classList.contains("toast")))return;a.preventDefault(),i.toggleView(!1),i.clickOutHandler.off()}}).off(),i.launchEventHandler=d.on.pointerdown(t,t=>{t.preventDefault(),i.toggleView()}),!0===s&&(s=div.background_cover()),i.toggleView=(l=!df.hasClass(e,"open"))=>{df.class(e,"open",l),df.class(t,"active",l),l?(s&&d.render(s),d.render(e,a),i.clickOutHandler.on(),app.toggleSituations.active&&app.toggleSituations.active.toggleView(!1),app.toggleSituations.active=i):(app.toggleSituations.active==i&&(app.toggleSituations.active=null),null!=o?(e.style.animation=n,i.launchEventHandler.off(),df.remove(e,o).then(()=>{s&&df.remove(s),e.style.animation="",i.launchEventHandler.on()})):(s&&df.remove(s),df.remove(e)))},app.toggleSituations.list.push(i),i},app.loadScriptsThenRunSequentially=(t,...e)=>new Promise(async(a,n)=>{const o=setTimeout(n,3e3*e.length),s=e[e.length-1];let i="";if(t&&s in localStorage)i=localStorage.getItem(s);else{const a={},n=[];for(const t of e)n.push(fetch(t).then(t=>t.text()).then(e=>{a[t]=e}));await Promise.all(n);for(const t in a)i+="\n;"+a[t];i+=`\n; app.emit("doneLoading:${s}");`,t&&localStorage.setItem(s,i)}app.once["doneLoading:"+s](a),df.script({$:document.head},i),clearTimeout(o)}),app.loadStyle=async(t,e)=>{let a;e&&t in localStorage?a=localStorage.getItem(t):(a=await(await fetch(t)).text(),e&&localStorage.setItem(t,a)),df.style({$:document.head},a)};const abreviateNum_units=["k","M","G","T","P","E","Z","Y"];app.abreviateNum=(t,e)=>{for(let a,n=abreviateNum_units.length-1;n>=0;n--)if(a=Math.pow(1e3,n+1),t<=-a||t>=a)return+(t/a).toFixed(e)+abreviateNum_units[n];return t},app.components={},app.components.toggleBox=(t,{id:e,checked:a,...n}={})=>div.togglebox(o=>o.input=input(d.merge({attr:{name:t,id:e,checked:a,type:"checkbox"}},n)),span()),d.createElementPlugins.contingentVisibility=(t,e)=>{if(d.isArr(t))var[t,a]=t;d.isStr(t)&&app.on["cv:"+t](t=>{t?e.removeAttribute("hidden"):e.setAttribute("hidden",!0),d.isFunc(a)&&a(t)})},app.dismissIcon=()=>d.html('<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 22px;">\n<polygon fill="rgb(255, 66, 66)" points="11.649 9.882 18.262 3.267 16.495 1.5 9.881 8.114 3.267 1.5 1.5 3.267 8.114 9.883 1.5 16.497 3.267 18.264 9.881 11.65 16.495 18.264 18.262 16.497">\n</polygon>\n</svg>'),app.cv=(t,e)=>{if(app.cv.map[t]==e)return!1;void 0===e&&(e=!app.cv.map[t]),app.emit["cv:"+t](app.cv.map[t]=!!e)},app.cv.check=t=>!!app.cv.map[t],app.cv.map=Object.create(null),app.toastContainer=section.toast_container({$:"body",contingentVisibility:"gotToast"}),app.cv("gotToast",!1),app.toastList=new Set,app.toast=new Proxy((t,e,a=15e3)=>{app.cv("gotToast",!0);const n=()=>{df.remove(o),app.toastList.delete(o),0==app.toastList.size&&app.cv("gotToast",!1)},o=div.toast[t]({$:app.toastContainer},span(e),span.dismiss_btn({onceclick(){n()}},app.dismissIcon()));return app.toastList.add(o),df.remove(o,a).then(n),o},{get:(t,e)=>t.bind(null,e)}),d.run(async()=>{try{await app.loadScriptsThenRunSequentially(!0,"https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.10.2/dayjs.min.js","https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.10.2/plugin/utc.min.js","https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.10.2/plugin/relativeTime.min.js"),window.dayjs.extend(window.dayjs_plugin_utc),window.dayjs.extend(window.dayjs_plugin_relativeTime),dayjs().utcOffset(2),app.emit("dayjsLoaded",app.dayjsLoaded=!0)}catch(t){console.error("failed to load dayjs")}}),app.dateFormat="HH:mm a DD MMM YYYY",app.dayjsUXTSformat=t=>{const e=dayjs.unix(t).utcOffset(2);return e.format(app.dateFormat)+" | "+e.fromNow()},app.renderUXTimestamp=(t,e=app.dayjsUXTSformat,a)=>{null==a&&(a=d.txt());try{a.textContent=e(t),(a.textContent.includes("minute")||a.textContent.includes("hour"))&&(a.updateInterval=setInterval((function n(){a.textContent=e(t),document.contains(a)?a.textContent.includes("hour")&&(clearInterval(a.updateInterval),a.updateInterval=setInterval(n,36e5)):clearInterval(a.updateInterval)}),6e4))}catch(n){a.textContent=new Date(1e3*t).toLocaleString(),app.once.dayjsLoaded(()=>app.renderUXTimestamp(t,e,a))}return a},app.vote=async(t,e,a)=>{try{const n=await fetch(`/${t}/${e}/${null==a?"unvote":a?"upvote":"downvote"}`);return await n.json()}catch(t){console.error("app.voteWrit error: ",t)}return!1},app.formatVoteCount=(t,e,a=2)=>{t.innerHTML="";let n=app.abreviateNum(e,a);if("string"==typeof n&&n.includes(".")){const t=n[n.length-1];n=n.substring(0,n.length-1);const[e,a]=n.split(".");n=[span(e),".",span.endbits(a),span.marker(t)]}d.render(n,t)},app.votesUI=(t,{id:e,vote:a=0,you_voted:n})=>o=>{const s=div.votes({async onclick(o,s){if(null==app.user){o.preventDefault(),app.oneTimeAuthLauncher&&app.oneTimeAuthLauncher.off();try{app.authViewToggle?app.authViewToggle.toggleView():await import("/js/auth.min.js")}catch(o){app.oneTimeAuthLauncher&&app.oneTimeAuthLauncher.on()}return}const i=o.target.classList.contains("up"),l=o.target.classList.contains("down");if(!l&&!i)return;o.target.classList.add("await-vote"),clearInterval(s.awaitAnimTimeout),s.awaitAnimTimeout=setTimeout(()=>{o.target.classList.remove("await-vote")},2500);const p=o.target.classList.contains("selected");if(null!=n&&p){const i=await app.vote(t,e);clearInterval(s.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=i&&(s.downvote.classList.remove("selected"),s.upvote.classList.remove("selected"),app.formatVoteCount(s.voteCount,a=i.data),n=null)}else if(i){const i=await app.vote(t,e,!0);clearInterval(s.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=i&&(s.downvote.classList.remove("selected"),s.upvote.classList.add("selected"),app.formatVoteCount(s.voteCount,a=i.data),n=!0)}else if(l){const i=await app.vote(t,e,!1);clearInterval(s.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=i&&(s.upvote.classList.remove("selected"),s.downvote.classList.add("selected"),app.formatVoteCount(s.voteCount,a=i.data),n=!1)}}});return s.append(s.upvote=span({class:{up:!0,vote:!0,selected:!0===n,"icon-up-open":!0}}),s.voteCount=span.vote_count(a),s.downvote=span({class:{down:!0,vote:!0,selected:!1===n,"icon-down-open":!0}})),s},app.filterTagInput=(t,e)=>{if(null==t.data)return e.commas=(e.value.match(/,/g)||[]).length,void(t.lastInput=e.value[e.value.length-1]);if(" "==t.data){const t=e.value.length;t&&","==e.value[t-2]||(e.value=e.value.slice(0,-1))}else","==t.data?","==e.lastInput||"-"==e.lastInput?e.value=e.value.slice(0,-1):1===e.value.length?e.value="":(e.commas?e.commas++:e.commas=1,e.commas>1?(e.value=[...new Set(e.value.split(",").map(t=>t.trim()).filter(t=>t.length>1&&t.length<23&&-1!==t.search(app.tagRegex)))].join(", ")+", ",e.commas=(e.value.match(/,/g)||[]).length,t.lastInput=e.value[e.value.length-1]):t.lastInput=t.data):"-"==t.data?1==e.value.length?e.value="":","==e.value[e.value.length-2]||"-"==e.value[e.value.length-2]?e.value=e.value.slice(0,-1):e.lastInput="-":t.data.match(/[a-zA-Z0-9, -]/)?e.lastInput=t.data:e.value=e.value.slice(0,-1)},app.tabView=({$:t,tabs:e=[],attacher:a="after",...n})=>{const o=header({onclick(t){t.target.classList.contains("tab-name")&&!t.target.classList.contains("active")&&i&&(i.name.classList.remove("active"),i=s[t.target.textContent],i.name.classList.add("active"),l.innerHTML="",d.render(i.view,l))}}),s=Object.create(null);e.map(({name:t,view:e})=>{s[t]={name:div.tab_name(t),view:e},o.append(s[t].name)});let i=s[e[0].name];i.name.classList.add("active");const l=div(i.view),p=article.tab_view(n,o,l);return t&&d.render(p,t,a),{element:p,get tabs(){return e},get views(){return s},add(t,a){e.push({name:t,view:a}),s[t]={name:div.tab_name({$:o},t),view:a}},remove(t){e=e.filter(e=>e.name!=t),df.remove(s[t].name),delete s[t]},set active(t){s[t]&&(i.name.classList.remove("active"),i=s[t],i.name.classList.add("active"),l.innerHTML="",d.render(i.view,l))},get active(){return i}}},window.app=app;export default app;
//# sourceMappingURL=site.min.js.map