import d from"/js/domlib.min.js";const app=d.emitter({d:d}),df=d.domfn,{div:div,article:article,textarea:textarea,input:input,a:a,p:p,button:button,hr:hr,h1:h1,h4:h4,section:section,span:span,header:header}=df,reqWithBody=(e="application/json",t=JSON.stringify)=>a=>(n,o,s={})=>fetch(n,{method:a,headers:{"Content-Type":e},body:t(o),...s}),jsonHTTPMethod=reqWithBody(),textHTTPMethod=reqWithBody("text/plain",e=>e);app.jsonPost=jsonHTTPMethod("POST"),app.jsonPut=jsonHTTPMethod("PUT"),app.jsonDelete=jsonHTTPMethod("DELETE"),app.txtPost=textHTTPMethod("POST"),app.txtPut=textHTTPMethod("PUT"),app.txtDelete=textHTTPMethod("DELETE");const wq=e=>async(t={})=>{isNaN(t.page)&&(t.page=0),t.kind||(t.kind="post");const a=await app.jsonPost(e,t);return await a.json()};app.writQuery=wq("/writs"),app.editableWritQuery=wq("/editable-writs"),app.toggleSituations={list:[],active:null},app.setupToggleSituation=(e,t,a="body",{viewOutAnimation:n,delayRemoveMS:o,background:s}={})=>{const i={};return i.clickOutHandler=d.on.pointerdown(document.body,a=>{if(a.target!=t&&!t.contains(a.target)&&df.hasClass(t,"open")&&a.target!=e){if(a.path.some(e=>e instanceof Element&&e.classList.contains("toast")))return;a.preventDefault(),i.toggleView(!1),i.clickOutHandler.off()}}).off(),i.launchEventHandler=d.on.pointerdown(e,e=>{e.preventDefault(),i.toggleView()}),!0===s&&(s=div.background_cover()),i.toggleView=(l=!df.hasClass(t,"open"))=>{df.class(t,"open",l),df.class(e,"active",l),l?(s&&d.render(s),d.render(t,a),i.clickOutHandler.on(),app.toggleSituations.active&&app.toggleSituations.active.toggleView(!1),app.toggleSituations.active=i):(app.toggleSituations.active==i&&(app.toggleSituations.active=null),null!=o?(t.style.animation=n,i.launchEventHandler.off(),df.remove(t,o).then(()=>{s&&df.remove(s),t.style.animation="",i.launchEventHandler.on()})):(s&&df.remove(s),df.remove(t)))},app.toggleSituations.list.push(i),i},app.loadScriptsThenRunSequentially=(e,...t)=>new Promise(async(a,n)=>{const o=setTimeout(n,3e3*t.length),s=t[t.length-1];let i="";if(e&&s in localStorage)i=localStorage.getItem(s);else{const a={},n=[];for(const e of t)n.push(fetch(e).then(e=>e.text()).then(t=>{a[e]=t}));await Promise.all(n);for(const e in a)i+="\n;"+a[e];i+=`\n; app.emit("doneLoading:${s}");`,e&&localStorage.setItem(s,i)}app.once["doneLoading:"+s](a),df.script({$:document.head},i),clearTimeout(o)}),app.loadStyle=async(e,t)=>{let a;t&&e in localStorage?a=localStorage.getItem(e):(a=await(await fetch(e)).text(),t&&localStorage.setItem(e,a)),df.style({$:document.head},a)};const abreviateNum_units=["k","M","G","T","P","E","Z","Y"];app.abreviateNum=(e,t)=>{for(let a,n=abreviateNum_units.length-1;n>=0;n--)if(a=Math.pow(1e3,n+1),e<=-a||e>=a)return+(e/a).toFixed(t)+abreviateNum_units[n];return e},app.components={},app.components.toggleBox=(e,{id:t,checked:a,...n}={})=>div.togglebox(o=>o.input=input(d.merge({attr:{name:e,id:t,checked:a,type:"checkbox"}},n)),span()),d.createElementPlugins.contingentVisibility=(e,t)=>{if(d.isArr(e))var[e,a]=e;d.isStr(e)&&app.on["cv:"+e](e=>{e?t.removeAttribute("hidden"):t.setAttribute("hidden",!0),d.isFunc(a)&&a(e)})},app.dismissIcon=()=>d.html('<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 22px;">\n<polygon fill="rgb(255, 66, 66)" points="11.649 9.882 18.262 3.267 16.495 1.5 9.881 8.114 3.267 1.5 1.5 3.267 8.114 9.883 1.5 16.497 3.267 18.264 9.881 11.65 16.495 18.264 18.262 16.497">\n</polygon>\n</svg>'),app.cv=(e,t)=>{if(app.cv.map[e]==t)return!1;void 0===t&&(t=!app.cv.map[e]),app.emit["cv:"+e](app.cv.map[e]=!!t)},app.cv.check=e=>!!app.cv.map[e],app.cv.map=Object.create(null),app.toastContainer=section.toast_container({$:"body",contingentVisibility:"gotToast"}),app.cv("gotToast",!1),app.toastList=new Set,app.toast=new Proxy((e,t,a=15e3)=>{app.cv("gotToast",!0);const n=()=>{df.remove(o),app.toastList.delete(o),0==app.toastList.size&&app.cv("gotToast",!1)},o=div.toast[e]({$:app.toastContainer},span(t),span.dismiss_btn({onceclick(){n()}},app.dismissIcon()));return app.toastList.add(o),df.remove(o,a).then(n),o},{get:(e,t)=>e.bind(null,t)}),d.run(async()=>{try{await app.loadScriptsThenRunSequentially(!0,"https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.10.2/dayjs.min.js","https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.10.2/plugin/utc.min.js","https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.10.2/plugin/relativeTime.min.js"),window.dayjs.extend(window.dayjs_plugin_utc),window.dayjs.extend(window.dayjs_plugin_relativeTime),dayjs().utcOffset(2),app.emit("dayjsLoaded",app.dayjsLoaded=!0)}catch(e){console.error("failed to load dayjs")}}),app.dateFormat="HH:mm a DD MMM YYYY",app.dayjsUXTSformat=e=>{const t=dayjs.unix(e).utcOffset(2);return t.format(app.dateFormat)+" | "+t.fromNow()},app.renderUXTimestamp=(e,t=app.dayjsUXTSformat,a)=>{null==a&&(a=d.txt());try{a.textContent=t(e),(a.textContent.includes("minute")||a.textContent.includes("hour"))&&(a.updateInterval=setInterval((function n(){a.textContent=t(e),document.contains(a)?a.textContent.includes("hour")&&(clearInterval(a.updateInterval),a.updateInterval=setInterval(n,36e5)):clearInterval(a.updateInterval)}),6e4))}catch(n){a.textContent=new Date(1e3*e).toLocaleString(),app.once.dayjsLoaded(()=>app.renderUXTimestamp(e,t,a))}return a},app.vote=async(e,t,a)=>{try{const n=await fetch(`/${e}/${t}/${null==a?"unvote":a?"upvote":"downvote"}`);return await n.json()}catch(e){console.error("app.voteWrit error: ",e)}return!1},app.formatVoteCount=(e,t,a=2)=>{e.innerHTML="";let n=app.abreviateNum(t,a);if("string"==typeof n&&n.includes(".")){const e=n[n.length-1];n=n.substring(0,n.length-1);const[t,a]=n.split(".");n=[span(t),".",span.endbits(a),span.marker(e)]}d.render(n,e)},app.votesUI=(e,{id:t,vote:a=0,you_voted:n})=>o=>{const s=div.votes({async onclick(o,s){if(null==app.user){o.preventDefault(),app.oneTimeAuthLauncher&&app.oneTimeAuthLauncher.off();try{app.authViewToggle?app.authViewToggle.toggleView():await import("/js/auth.min.js")}catch(o){app.oneTimeAuthLauncher&&app.oneTimeAuthLauncher.on()}return}const i=o.target.classList.contains("up"),l=o.target.classList.contains("down");if(!l&&!i)return;o.target.classList.add("await-vote"),clearInterval(s.awaitAnimTimeout),s.awaitAnimTimeout=setTimeout(()=>{o.target.classList.remove("await-vote")},2500);const p=o.target.classList.contains("selected");if(null!=n&&p){const i=await app.vote(e,t);clearInterval(s.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=i&&(s.downvote.classList.remove("selected"),s.upvote.classList.remove("selected"),app.formatVoteCount(s.voteCount,a=i.data),n=null)}else if(i){const i=await app.vote(e,t,!0);clearInterval(s.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=i&&(s.downvote.classList.remove("selected"),s.upvote.classList.add("selected"),app.formatVoteCount(s.voteCount,a=i.data),n=!0)}else if(l){const i=await app.vote(e,t,!1);clearInterval(s.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=i&&(s.upvote.classList.remove("selected"),s.downvote.classList.add("selected"),app.formatVoteCount(s.voteCount,a=i.data),n=!1)}}});return s.append(s.upvote=span({class:{up:!0,vote:!0,selected:!0===n,"icon-up-open":!0}}),s.voteCount=span.vote_count(a),s.downvote=span({class:{down:!0,vote:!0,selected:!1===n,"icon-down-open":!0}})),s},app.filterTagInput=(e,t)=>{if(null==e.data)return t.commas=(t.value.match(/,/g)||[]).length,void(e.lastInput=t.value[t.value.length-1]);if(" "==e.data){const e=t.value.length;e&&","==t.value[e-2]||(t.value=t.value.slice(0,-1))}else","==e.data?","==t.lastInput||"-"==t.lastInput?t.value=t.value.slice(0,-1):1===t.value.length?t.value="":(t.commas?t.commas++:t.commas=1,t.commas>1?(t.value=[...new Set(t.value.split(",").map(e=>e.trim()).filter(e=>e.length>1&&e.length<23&&-1!==e.search(app.tagRegex)))].join(", ")+", ",t.commas=(t.value.match(/,/g)||[]).length,e.lastInput=t.value[t.value.length-1]):e.lastInput=e.data):"-"==e.data?1==t.value.length?t.value="":","==t.value[t.value.length-2]||"-"==t.value[t.value.length-2]?t.value=t.value.slice(0,-1):t.lastInput="-":e.data.match(/[a-zA-Z0-9, -]/)?t.lastInput=e.data:t.value=t.value.slice(0,-1)},app.tabView=({$:e,tabs:t=[],attacher:a="after",...n})=>{const o=header({onclick(e){e.target.classList.contains("tab-name")&&!e.target.classList.contains("active")&&i&&(i.name.classList.remove("active"),i=s[e.target.textContent],i.name.classList.add("active"),l.innerHTML="",d.render(i.view,l))}}),s=Object.create(null);t.map(({name:e,view:t})=>{s[e]={name:div.tab_name(e),view:t},o.append(s[e].name)});let i=s[t[0].name];i.name.classList.add("active");const l=div(i.view),p=article.tab_view(n,o,l);return e&&d.render(p,e,a),{element:p,get tabs(){return t},get views(){return s},add(e,a){t.push({name:e,view:a}),s[e]={name:div.tab_name({$:o},e),view:a}},remove(e){t=t.filter(t=>t.name!=e),df.remove(s[e].name),delete s[e]},set active(e){s[e]&&(i.name.classList.remove("active"),i=s[e],i.name.classList.add("active"),l.innerHTML="",d.render(i.view,l))},get active(){return i}}};const isURL=e=>{try{return new URL(e),!0}catch(e){}return!1},Socket=(e,t)=>{if(!isURL(e)){let t=e.match(/^(\/.*?)?$/);if(d.isEmpty(t))throw new Error("invalid url");e=location.host+t[0]}if(e.includes("ws://")||e.includes("wss://")||(e=("http:"===location.protocol?"ws://":"wss://")+e),isURL(e)){const n=()=>new WebSocket(e,t),o={socket:null,open:!1,recievers:[],message:"",send(e){if(1==o.socket.readyState)o.socket.send(d.isObj(e)?JSON.stringify(e):e);else{const t=setInterval(()=>{1==o.socket.readyState&&(o.socket.send(d.isObj(e)?JSON.stringify(e):e),clearInterval(t))},15);setTimeout(e=>clearInterval(t),2e3)}return o},recieve(e){d.isFunc(e)&&o.recievers.push(e)},get msg(){return o.message},close(){o.socket.close()},reopen(){a()}};function a(e=(o.open?o.socket:o.socket=n())){e.onopen=()=>{o.open=!0,e.onmessage=e=>{o.message=e.data,o.recievers.forEach(t=>t(e.data,e))}},e.onclose=()=>{o.open=!1},e.onerror=e=>{throw e}}return a(o.socket=n()),o}};d.run(app.sock=()=>{app.ws=Socket("/ws/"),app.ws.recieve(e=>{console.log("ws-msg: ",e)}),app.ws.send("This is a websocket message. D'ya hear it?!?!?!?")}),window.app=app;export default app;
//# sourceMappingURL=site.min.js.map