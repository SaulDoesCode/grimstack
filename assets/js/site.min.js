import domlib from"/js/domlib.min.js";const app=domlib.emitter(),d=app.d=domlib,df=domlib.domfn,{div:div,article:article,a:a,p:p,button:button,hr:hr,h1:h1,h4:h4,section:section,span:span,header:header}=df,reqWithBody=(t="application/json",e=JSON.stringify)=>a=>(o,n,s={})=>fetch(o,{method:a,headers:{"Content-Type":t},body:e(n),...s}),jsonHTTPMethod=reqWithBody(),textHTTPMethod=reqWithBody("text/plain",t=>t);app.jsonPost=jsonHTTPMethod("POST"),app.jsonPut=jsonHTTPMethod("PUT"),app.jsonDelete=jsonHTTPMethod("DELETE"),app.txtPost=textHTTPMethod("POST"),app.txtPut=textHTTPMethod("PUT"),app.txtDelete=textHTTPMethod("DELETE");const wq=t=>async(e={})=>{isNaN(e.page)&&(e.page=0),e.kind||(e.kind="post");const a=await app.jsonPost(t,e);return await a.json()};app.writQuery=wq("/writs"),app.editableWritQuery=wq("/editable-writs"),app.toggleSituations={list:[],active:null},app.setupToggleSituation=(t,e,a="body",{viewOutAnimation:o,delayRemoveMS:n,background:s}={})=>{const i={};return i.clickOutHandler=d.on.pointerdown(document.body,a=>{a.target!=e&&!e.contains(a.target)&&df.hasClass(e,"open")&&a.target!=t&&(a.preventDefault(),i.toggleView(!1),i.clickOutHandler.off())}).off(),i.launchEventHandler=d.on.pointerdown(t,t=>{t.preventDefault(),i.toggleView()}),!0===s&&(s=df.div({class:"background-cover"})),i.toggleView=(p=!df.hasClass(e,"open"))=>{df.class(e,"open",p),df.class(t,"active",p),p?(s&&d.render(s),d.render(e,a),i.clickOutHandler.on(),app.toggleSituations.active&&app.toggleSituations.active.toggleView(!1),app.toggleSituations.active=i):(app.toggleSituations.active==i&&(app.toggleSituations.active=null),null!=n?(e.style.animation=o,i.launchEventHandler.off(),df.remove(e,n).then(()=>{s&&df.remove(s),e.style.animation="",i.launchEventHandler.on()})):(s&&df.remove(s),df.remove(e)))},app.toggleSituations.list.push(i),i},app.loadScriptsThenRunSequentially=(t,...e)=>new Promise(async(a,o)=>{const n=setTimeout(o,3e3*e.length),s=e[e.length-1];let i="";if(t&&s in localStorage)i=localStorage.getItem(s);else{const a={},o=[];for(const t of e)o.push(fetch(t).then(t=>t.text()).then(e=>{a[t]=e}));await Promise.all(o);for(const t in a)i+="\n;"+a[t];i+=`\n; app.emit("doneLoading:${s}");`,t&&localStorage.setItem(s,i)}app.once["doneLoading:"+s](a),df.script({$:document.head},i),clearTimeout(n)}),app.loadStyle=async(t,e)=>{let a;e&&t in localStorage?a=localStorage.getItem(t):(a=await(await fetch(t)).text(),e&&localStorage.setItem(t,a)),df.style({$:document.head},a)};const abreviateNum_units=["k","M","G","T","P","E","Z","Y"];app.abreviateNum=(t,e)=>{for(let a,o=abreviateNum_units.length-1;o>=0;o--)if(a=Math.pow(1e3,o+1),t<=-a||t>=a)return+(t/a).toFixed(e)+abreviateNum_units[o];return t},app.components={},app.components.toggleBox=(t,{id:e,checked:a,...o}={})=>df.div({class:"togglebox"},n=>n.input=df.input(d.merge({attr:{name:t,id:e,checked:a,type:"checkbox"}},o)),df.span()),domlib.createElementPlugins.contingentVisibility=(t,e)=>{if(domlib.isArr(t))var[t,a]=t;domlib.isStr(t)&&app.on["cv:"+t](t=>{t?e.removeAttribute("hidden"):e.setAttribute("hidden",!0),domlib.isFunc(a)&&a(t)})},app.dismissIcon=()=>domlib.html('<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 22px;">\n<polygon fill="rgb(255, 66, 66)" points="11.649 9.882 18.262 3.267 16.495 1.5 9.881 8.114 3.267 1.5 1.5 3.267 8.114 9.883 1.5 16.497 3.267 18.264 9.881 11.65 16.495 18.264 18.262 16.497">\n</polygon>\n</svg>'),app.cv=(t,e)=>{if(app.cv.map[t]==e)return!1;void 0===e&&(e=!app.cv.map[t]),app.emit["cv:"+t](app.cv.map[t]=!!e)},app.cv.check=t=>!!app.cv.map[t],app.cv.map=Object.create(null),app.toastContainer=df.section({$:"body",class:"toast-container",contingentVisibility:"gotToast"}),app.cv("gotToast",!1),app.toastList=new Set,app.toast=new Proxy((t,e,a=15e3)=>{app.cv("gotToast",!0);const o=()=>{df.remove(n),app.toastList.delete(n),0==app.toastList.size&&app.cv("gotToast",!1)},n=df.div({$:app.toastContainer,class:"toast "+t},df.span(e),df.span({class:"dismiss-btn",onceclick(){o()}},app.dismissIcon()));return app.toastList.add(n),df.remove(n,a).then(o),n},{get:(t,e)=>t.bind(null,e)}),d.run(async()=>{try{await app.loadScriptsThenRunSequentially(!0,"https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.36/dayjs.min.js","https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.36/plugin/utc.min.js","https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.36/plugin/relativeTime.min.js"),window.dayjs.extend(window.dayjs_plugin_utc),window.dayjs.extend(window.dayjs_plugin_relativeTime),dayjs().utcOffset(2),app.emit("dayjsLoaded",app.dayjsLoaded=!0)}catch(t){}}),app.dateFormat="HH:mm a DD MMM YYYY",app.dayjsUXTSformat=t=>{const e=dayjs.unix(t).utcOffset(2);return e.format(app.dateFormat)+" | "+e.fromNow()},app.renderUXTimestamp=(t,e=app.dayjsUXTSformat,a)=>{null==a&&(a=d.txt());try{a.textContent=e(t),(a.textContent.includes("minute")||a.textContent.includes("hour"))&&(a.updateInterval=setInterval((function o(){a.textContent=e(t),document.contains(a)?a.textContent.includes("hour")&&(clearInterval(a.updateInterval),a.updateInterval=setInterval(o,36e5)):clearInterval(a.updateInterval)}),6e4))}catch(o){a.textContent=new Date(1e3*t).toLocaleString(),app.once.dayjsLoaded(()=>app.renderUXTimestamp(t,e,a))}return a},app.vote=async(t,e,a)=>{try{const o=await fetch(`/${t}/${e}/${null==a?"unvote":a?"upvote":"downvote"}`);return await o.json()}catch(t){console.error("app.voteWrit error: ",t)}return!1},app.formatVoteCount=(t,e,a=2)=>{t.innerHTML="";let o=app.abreviateNum(e,a);if("string"==typeof o&&o.includes(".")){const t=o[o.length-1];o=o.substring(0,o.length-1);const[e,a]=o.split(".");o=[span(e),".",span({class:"endbits"},a),span({class:"marker"},t)]}d.render(o,t)},app.votesUI=(t,{id:e,vote:a=0,you_voted:o})=>n=>{const s=div({class:"votes",async onclick(n,s){if(null==app.user){n.preventDefault(),app.oneTimeAuthLauncher&&app.oneTimeAuthLauncher.off();try{app.authViewToggle?app.authViewToggle.toggleView():await import("/js/auth.min.js")}catch(n){app.oneTimeAuthLauncher&&app.oneTimeAuthLauncher.on()}return}const i=n.target.classList.contains("up"),p=n.target.classList.contains("down");if(!p&&!i)return;n.target.classList.add("await-vote"),clearInterval(s.awaitAnimTimeout),s.awaitAnimTimeout=setTimeout(()=>{n.target.classList.remove("await-vote")},2500);const l=n.target.classList.contains("selected");if(null!=o&&l){const i=await app.vote(t,e);clearInterval(s.awaitAnimTimeout),n.target.classList.remove("await-vote"),0!=i&&(s.downvote.classList.remove("selected"),s.upvote.classList.remove("selected"),app.formatVoteCount(s.voteCount,a=i.data),o=null)}else if(i){const i=await app.vote(t,e,!0);clearInterval(s.awaitAnimTimeout),n.target.classList.remove("await-vote"),0!=i&&(s.downvote.classList.remove("selected"),s.upvote.classList.add("selected"),app.formatVoteCount(s.voteCount,a=i.data),o=!0)}else if(p){const i=await app.vote(t,e,!1);clearInterval(s.awaitAnimTimeout),n.target.classList.remove("await-vote"),0!=i&&(s.upvote.classList.remove("selected"),s.downvote.classList.add("selected"),app.formatVoteCount(s.voteCount,a=i.data),o=!1)}}});return s.append(s.upvote=span({class:{up:!0,vote:!0,selected:!0===o,"icon-up-open":!0}}),s.voteCount=span({class:"vote-count"},a),s.downvote=span({class:{down:!0,vote:!0,selected:!1===o,"icon-down-open":!0}})),s},window.app=app;export default app;
//# sourceMappingURL=site.min.js.map