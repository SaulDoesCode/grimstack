const app=domlib.emitter();{const{titleInput:t,rawContentInput:e,preview:i,tagsInput:n,writKind:a,pushWritButton:l,writList:p}=domlib.html`
<section class="writ-editor">
  <div class="title">
      <label>title</label>
      <input type="text" name="title" ref="titleInput">
  </div>
  <div class="editor">
      <div class="pad">
          <label>editor</label>
          <textarea name="raw_content" cols="30" rows="10" ref="rawContentInput">
          </textarea>
      </div>
      <div class="preview" ref="preview">
      </div>
  </div>
  <div class="tager">
      <label>tags</label>
      <input type="text" name="tags" ref="tagsInput">
  </div>
  <div class="kind">
      <label>kind</label>
      <input type="text" name="kind" value="post" ref="writKind">
  </div>
  <br>
  <button ref="pushWritButton">push writ</button>
</section>

<section class="writ-list" ref="writList"></section>
`.renderCollect();e.value="",app.writs=[],app.post=(t,e)=>fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),app.put=(t,e)=>fetch(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),app.writQuery=(t={})=>new Promise((e,i)=>{isNaN(t.page)&&(t.page=1),t.kind||(t.kind="post"),app.post("/writs",t).then(t=>t.json().then(e))}),app.pushWrit=(i={})=>new Promise((l,p)=>{i.title||(i.title=t.value.trim()),i.raw_content||(i.raw_content=e.value.trim()),i.tags||(i.tags=n.value.trim().split(",").map(t=>t.trim())),i.kind||(i.kind=a.value.trim()||"post"),null==i.public&&(i.public=!0),null==i.viewable_by&&(i.viewable_by=[]);for(const[t,e]of Object.entries(i))if("public"!=t&&"viewable_by"!=t&&(null==e||!e.length))return domlib.run(()=>{throw new Error("pushWrit: Invalid/Empty field - "+t)}),p({ok:!1});app.put("/writ",i).then(t=>t.json()).then(t=>t.ok?l(t.data):p(t))});const r=domlib.once.click(l,t=>{app.pushWrit().ok||r.on()});app.remoteHttp=async(t,e={})=>(null==e.method&&(e.method="get"),e.url=t,await(await fetch("/remote-http",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json())}