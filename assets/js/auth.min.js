import app from"/js/site.min.js";const d=app.d,df=d.domfn,authLauncher=d.query(".auth-launcher")||df.div.auth_launcher({$:"body"},"Auth"),{authView:authView,usernameInput:usernameInput,emailInput:emailInput,authBtn:authBtn}=d.h`
<section class="auth-view" ref="authView">
  <div>
    <div class="auth-form-field">
      <label for="auth-username">Username</label>
      <input type="text" name="username" id="auth-username" ref="usernameInput">
      <label for="auth-email">Email</label>
      <input type="text" name="email" id="auth-email" ref="emailInput">
    </div>
    <button class="submit" ref="authBtn">authenticate</button>
  </div>
</section>`.collect();app.authViewToggle=app.setupToggleSituation(authLauncher,app.authView=authView,"body",{background:!0});const authMsg=df.div({class:"auth-msg"}),showAuthMsg=(t,a)=>{df.attrToggle(authBtn,"hidden",!0),authMsg.textContent=t,authView.contains(authMsg)||authView.append(authMsg),a&&df.remove(authMsg,a).then(()=>{df.attrToggle(authBtn,"hidden",void 0),authView.append(authBtn)})};app.authenticate=async(t=usernameInput.value.trim(),a=emailInput.value.trim())=>{if(""==t)throw""!=a&&a.includes("@")?showAuthMsg("username is invalid",4500):showAuthMsg("username & email are invalid",4500),new Error("username is invalid");if(""==a||!a.includes("@"))throw showAuthMsg("email is invalid",4500),new Error("email is invalid");showAuthMsg("attempting authentication...");const e=await app.jsonPost("/auth",{username:t,email:a}),n=await e.json();if(console.log(n),n.ok){app.toast.msg("auth went through: "+n.status),showAuthMsg("auth went through: "+n.status);try{await app.try_auth_verify()}catch(t){}return!0}throw app.toast.error("auth failed: "+n.status),showAuthMsg("auth failed: "+n.status,5e3),new Error("authentication failed: "+n.status)},app.try_auth_verify=()=>new Promise((t,a)=>{let e=!0,n=setTimeout(()=>{e=!1,clearInterval(u),a()},6e5),u=setInterval(async()=>{if(!e)return clearInterval(u),clearTimeout(n),void a();const i=await(await fetch("/auth/verification")).json();i.ok?(app.toast.msg("Auth: "+i.status),clearInterval(u),clearTimeout(n),t(),setTimeout(()=>{window.location.reload()},3e3)):(console.log(i),i.status.includes("expire")&&i.status.includes("preauth")&&setTimeout(()=>{window.location.reload()},"localhost"==window.location.hostname?4500:800))},1500)});const authClickHandle=d.once.click(authBtn,async t=>{try{await app.authenticate()}catch(t){console.error(t),authClickHandle.on()}});let mlSuccess=localStorage.getItem("ml-success");window.addEventListener("storage",()=>{mlSuccess!==localStorage.getItem("ml-success")&&(localStorage.removeItem("ml-success"),"localhost"==window.location.hostname?document.body.innerHTML="<h1>Yeah, auth worked and all that.</h1>":window.close())}),"/"===window.location.pathname&&app.authViewToggle.toggleView();
//# sourceMappingURL=auth.min.js.map