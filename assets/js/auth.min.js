import app from"/js/site.min.js";const d=app.d,df=d.domfn,authLauncher=d.query(".auth-launcher"),{authView:authView,usernameInput:usernameInput,emailInput:emailInput,authBtn:authBtn}=d.h`
<section class="auth-view" ref="authView">
  <div>
    <div class="auth-form-field">
      <label for="auth-username">Username</label>
      <input type="text" name="username" id="auth-username" ref="usernameInput">
      <label for="auth-email">Email</label>
      <input type="text" name="email" id="auth-email" ref="emailInput">
    </div>
    <button class="submit" ref="authBtn">authenticate</button>
  </div>
</section>`.collect();app.authViewToggle=app.setupToggleSituation(authLauncher,app.authView=authView,"body",{background:!0}),app.authenticate=async(t=usernameInput.value.trim(),e=emailInput.value.trim())=>{if(""==t)throw new Error("username is invalid");if(""==e||!e.includes("@"))throw new Error("email is invalid");console.log("attempting authentication...");const a=await app.jsonPost("/auth",{username:t,email:e}),n=await a.json();if(console.log(n),n.ok){app.toast.msg("auth went through: "+n.status);try{await app.try_auth_verify()}catch(t){}return!0}throw app.toast.error("auth failed: "+n.status),new Error("authentication failed: "+n.status)},app.try_auth_verify=()=>new Promise((t,e)=>{let a=!0,n=setTimeout(()=>{a=!1,clearInterval(o),e()},6e5),o=setInterval(async()=>{if(!a)return clearInterval(o),clearTimeout(n),void e();const i=await(await fetch("/auth/verification")).json();i.ok?(app.toast.msg("Auth: "+i.status),clearInterval(o),clearTimeout(n),t(),setTimeout(()=>{window.location.reload()},3e3)):(console.log(i),i.status.includes("expire")&&i.status.includes("preauth")&&setTimeout(()=>{window.location.reload()},"localhost"==window.location.hostname?4500:800))},1500)});const authClickHandle=d.once.click(authBtn,async t=>{try{await app.authenticate()}catch(t){console.error(t),authClickHandle.on()}});let mlSuccess=localStorage.getItem("ml-success");window.addEventListener("storage",()=>{mlSuccess!==localStorage.getItem("ml-success")&&(localStorage.removeItem("ml-success"),"localhost"==window.location.hostname?document.body.innerHTML="<h1>Yeah, auth worked and all that.</h1>":window.close())}),app.authViewToggle.toggleView();
//# sourceMappingURL=auth.min.js.map