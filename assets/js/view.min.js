import app from"/js/site.min.js";import route from"/js/router.min.js";const d=app.d,df=d.domfn,{div:div,h4:h4,section:section,span:span,header:header}=df,mainView=d.query("main[route-active]"),contentDisplay=df.section({class:"posts"}),postDisplay=df.section({class:"post"},t=>{t.parts=d.h`
        <header class="post-header">
            <div>
                <h3 class="post-title" ref="title"></h3>
                <div class="author-name" ref="author"></div>
            </div>
            <div>
                <div class="posted" ref="date"></div>
                <div class="tags" ref="tags"></div>
            </div>
        </header>
    
        <article class="content" ref="content">
        </article>

        <aside class="post-comments" hidden ref="commentContainer">
            <header>Comments</header>
            <div ref="commentMaker"></div>
            <div ref="comments"></div>
        </aside>
    `.renderCollect(t)});route("posts",contentDisplay),""!=location.hash&&"#"!=location.hash||(location.hash="posts"),route("post",postDisplay);const postNavView=d.html('\n    <nav class="post-nav">\n        <button class="post-back-btn" onclick="location.hash = \'posts\'">\n            <- Go back to post list\n        </button>\n    </nav>\n');route.on.post(t=>app.afterPostsInitialization(async()=>{const s=app.activePost=app.posts[t],{title:e,tags:a,author:o,date:n,content:i,comments:p,commentsContainer:r}=postDisplay.parts;e.textContent=s.title,n.innerHTML="",n.textContent=new Date(1e3*s.posted).toLocaleString(),a.innerHTML="",s.tags.map(t=>df.span({$:a,class:"tag"},t)),o.textContent="By "+s.author_name,i.innerHTML="Content loading...",app.fetchPostContent(s.id).then(t=>{i.innerHTML="",d.render(d.html(t),i),setTimeout(()=>{d.queryAll(".content code",i).forEach(t=>{t.classList.add("language-rust")})},150)}),df.prepend(mainView,postNavView)})),app.view={page:0};const publicPost=t=>div({$:contentDisplay,class:"post",attr:{pid:t.id},onclick(s,e){location.hash=t.id,app.fetchPostContent(t.id)}},header(div(h4(t.title),div({class:"author-name"},"By "+t.author_name)),div(div({class:"posted"},new Date(1e3*t.posted).toLocaleString()),div({class:"tags"},t.tags.map(t=>span({class:"tag"},t))))));app.fetchPostContent=async t=>{if(app.posts[t]&&null!=app.posts[t].content)return app.posts[t].content;const s=await fetch("/post-content/"+t),e=await s.json();if(e.ok)return app.posts[t].content=e.data;throw new Error(e.status)},app.posts=Object.create(null),app.writQuery({with_content:!1,kind:"post"}).then(t=>{if(!d.isArr(t))return console.error(t);t.forEach(t=>{app.posts[t.id]=t,publicPost(t)}),app.postsInitialized=!0,app.emit.postsInitialized(),document.head.append(df.link({attr:{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/prism/1.21.0/themes/prism-tomorrow.min.css"}}))}),app.afterPostsInitialization=t=>{app.postsInitialized?t():app.once.postsInitialized(t)};
//# sourceMappingURL=view.min.js.map