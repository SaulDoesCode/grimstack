import app from"/js/site.min.js";import route from"/js/router.min.js";const d=app.d,df=d.domfn,{div:div,article:article,a:a,p:p,button:button,hr:hr,h1:h1,h4:h4,section:section,span:span,header:header}=df,mainView=d.query("main[route-active]"),postListView=div({class:"post-list"}),contentDisplay=section({class:"posts"},postListView);app.postDisplay=section({class:"full post"},t=>{t.parts=d.h`
        <header class="post-header">
            <div>
                <h3 class="post-title" ref="title"></h3>
                <div class="author-name" ref="author"></div>
                <div> ‚óè </div>
                <time class="posted" ref="date"></time>
                <div class="tags" ref="tags"></div>
            </div>
        </header>
        <article class="content" ref="content"></article>
    `.renderCollect(t)}),route("posts",contentDisplay),""!=location.hash&&"#"!=location.hash||(location.hash="posts",route.handle()),route("post",app.postDisplay),route("no-content",div({class:"no-content"},h1("Sorry folks, no content. This website is barren."),button({onclick(){location.hash="posts",window.location="/"}},"Reload page, maybe it helps.")));const postNavView=d.html('\n    <nav class="post-nav">\n        <button class="post-back-btn" onclick="location.hash = app.fancyHash || \'posts\'">\n            <span class="icon-left-open"></span>\n            Back to Post List\n        </button>\n    </nav>\n'),quickScroll=d.html('\n<nav class="quick-scroll">\n    <div class="to-top icon-up-open" onclick="window.scrollTo({top: 0, left: 0, behavior: \'smooth\'})">\n    </div>\n    <div class="to-comments icon-comment" onclick="document.querySelector(\'#comments\').scrollIntoView({behavior: \'smooth\'})">\n    </div>\n</nav>');route.on.post(async t=>{setTimeout(()=>{!app.posts[t]&&app.failedToFetchPosts&&(location.hash="no-content",route.handle())},1200),await app.afterPostsInitialization();const o=app.activePost=app.posts[t];if(null==o)return location.hash="no-content",void route.handle();const{title:a,tags:s,author:e,date:n,content:p}=app.postDisplay.parts;a.textContent=o.title,n.innerHTML="",d.render(app.renderUXTimestamp(o.posted),n),s.innerHTML="",o.tags.map(t=>df.span({$:s,attr:{title:t},class:"tag"},t)),e.textContent="By "+o.author_name,p.innerHTML="Content loading...",app.commentsDisplay&&df.remove(app.commentsDisplay),df.prepend(mainView,postNavView);const i=await app.fetchPostContent(o.id);p.innerHTML="",o==app.activePost&&(d.render(d.html(i),p),setTimeout(()=>d.queryAll(".content code",p).forEach(t=>{t.classList.add("language-rust")}),60),d.render(quickScroll)),app.emit.postRendered(o,t)}),route.on.change(()=>{location.hash.includes("post:")||df.remove(quickScroll)});const publicPost=t=>div({$:postListView,class:"post",attr:{pid:t.id},onclick(o,a){o.target.className.includes("vote")||(location.hash=t.id)}},o=>{const a=h4(t.title);return app.on("postEdit:"+t.id,s=>{!1===s?(df.remove(o),app.postPages[t.page]=app.postPages[t.page].filter(o=>o!=t.id),delete app.posts[t.id],location.hash.includes(t.id)&&(location.hash="posts")):(location.hash.includes("no-content")&&(location.hash="posts",route.handle()),a.textContent=app.posts[t.id].title=s.title,app.posts[t.id].commentable=s.commentable)}),[header(div({class:"title"},a,div({class:"author-name"},"By "+t.author_name)),div({class:"posted"},app.renderUXTimestamp(t.posted)),df.hr(),app.votesUI("writ",t),div({class:"tags"},t.tags.map(t=>span({class:"tag",attr:{title:t}},t))))]});app.fetchPostContent=async t=>{if(app.posts[t]&&null!=app.posts[t].content)return app.posts[t].content;const o=await fetch("/post-content/"+t),a=await o.json();if(!a.ok)throw new Error(a.status);return app.posts[t].content=a.data},app.posts=Object.create(null),app.postPages=Object.create(null),app.postPaginationView=section({class:"post-pagination"},app.postPageBackBtn=div({class:"page-back",contingentVisibility:"pageNot0",onclick(t){app.fetchPosts(app.activePostPage-1)}},"<<"),app.pageNumView=div({class:"page-num"}),app.postPageForwardBtn=div({class:"page-forward",onclick(t){app.fetchPosts(app.activePostPage+1)}},">>")),app.fetchPosts=async(t=0,o=6)=>{let a;if("no-content"==route.hash()&&(app.failedToFetchPosts?(location.hash="posts",route.handle(),console.warn("not sure what happened")):(location.hash="posts",route.handle(),console.log("false alarm"))),d.isArr(app.postPages[t])){postListView.innerHTML="";let a=0;for(const s of app.postPages[t])if(publicPost(app.posts[s]),++a>=o)break}else{try{if(a=await app.writQuery({with_content:!1,kind:"post",amount:o,public:!0,page:t}),!d.isArr(a))throw 0==t&&(mainView.innerHTML="",app.failedToFetchPosts=!0,location.hash="no-content",route.handle()),console.error(a),new Error(a.status)}catch(o){return app.postPageForwardBtn.style.color="red",app.postPageForwardBtn.textContent="404",setTimeout(()=>{app.postPageForwardBtn.style.color="",app.postPageForwardBtn.textContent=">>"},3e3),void(location.hash.includes("post:")?0==t?(app.failedToFetchPosts=!0,location.hash="no-content",route.handle()):(location.hash="posts",route.handle()):0==t&&(mainView.innerHTML="",app.failedToFetchPosts=!0,location.hash="no-content",route.handle()))}app.postPages[t]=[],postListView.innerHTML="",a.length>=5&&d.render(app.postPaginationView,contentDisplay),a.forEach(o=>{o.page=t,app.postPages[t].push(o.id),publicPost(app.posts[o.id]=o)})}app.emit.activePostPage(app.activePostPage=t),app.pageNumView.textContent=t,app.cv("pageNot0",0!=t),app.postsInitialized||(app.emit.postsInitialized(app.postsInitialized=!0),app.loadStyle("https://cdnjs.cloudflare.com/ajax/libs/prism/1.21.0/themes/prism-tomorrow.min.css",!0),await import("/js/comments.min.js"))},app.fetchPosts(),app.on.newPost(()=>{app.posts=Object.create(null),app.postPages=Object.create(null),postListView.innerHTML="",app.fetchPosts()}),app.afterPostsInitialization=t=>app.postsInitialized?null!=t?t():Promise.resolve(!0):null!=t?app.once.postsInitialized(t):new Promise(app.once.postsInitialized);
//# sourceMappingURL=view.min.js.map