app.initDropdown=e=>{let o;e.isDropdownOpen=()=>e.classList.contains("open"),app.whenHoveringOver(e,o=>{e.isDropdownOpen()||e.toggleDropdown(!0)}),e.toggleDropdown=(n=!e.isDropdownOpen())=>n?(app.openDropdown&&app.openDropdown.toggleDropdown(!1),app.openDropdown=e,e.classList.add("open"),e.clickawayHandle.on(),o=app.whenNotHoveringOver(e,o=>{clearTimeout(e.closeTimeout),e.closeTimeout=setTimeout(()=>{e.isDropdownOpen()&&(e.toggleDropdown(!1),o.off())},1500),app.whenHoveringOver(e,n=>{clearTimeout(e.closeTimeout),n.off(),o.on()})}),e):(e.classList.remove("open"),e.clickawayHandle.off(),o&&o.off(),app.openDropdown=null,e),e.clickawayHandle=domlib.on.click(document.body,o=>{o.target==e||e.contains(o.target)||e.toggleDropdown(!1)}).off()},app.NotHoveringOverHandlers=[],app.HoveringOverHandlers=[],app.whenNotHoveringOver=(e,o)=>{o.el=e;const n=domlib.on.pointerleave(e,e=>{o.notified||(o.notified=!0,o(o))}).off();return o.off=()=>(o.isOn&&(o.isOn=!1,app.NotHoveringOverHandlers.splice(o.i,1),n.off()),o),o.on=()=>(o.isOn||(o.isOn=!0,o.i=app.NotHoveringOverHandlers.push(o)-1,n.on()),o),o.on()},app.whenHoveringOver=(e,o)=>(o.el=e,o.off=()=>(app.HoveringOverHandlers.splice(o.i,1),o.isOn=!1,o),o.on=()=>(o.isOn||(o.isOn=!0,o.i=app.HoveringOverHandlers.push(o)-1),o),o.on()),app.isHoveringOver=e=>app.hoveringOn.includes(e),app.hoverElementChanged=e=>{for(const e of app.NotHoveringOverHandlers)app.isHoveringOver(e.el)?e.notified=!1:e.notified||(e.notified=!0,e(e));for(const e of app.HoveringOverHandlers)app.isHoveringOver(e.el)?e.notified||(e.notified=!0,e(e)):e.notified=!1},domlib.run(()=>{app.compareHoverPath=e=>{app.lastHoveringOn?e.path[0]!=app.lastHoveringOn[0]&&(app.lastHoveringOn=app.hoveringOn,app.hoverElementChanged(app.hoveringOn=e.path)):app.hoverElementChanged(app.lastHoveringOn=app.hoveringOn=e.path)},document.body.addEventListener("pointerover",app.compareHoverPath,{passive:!0}),document.body.addEventListener("pointerenter",app.compareHoverPath,{passive:!0}),(app.dropdowns=[...document.querySelectorAll(".dropdown")]).forEach(app.initDropdown)});