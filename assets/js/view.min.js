import app from"/js/site.min.js";import route from"/js/router.min.js";const d=app.d,df=d.domfn,{div:div,h4:h4,section:section,span:span,header:header}=df,mainView=d.query("main[route-active]"),postListView=div({class:"post-list"}),contentDisplay=section({class:"posts"},postListView);app.postDisplay=section({class:"full post"},t=>{t.parts=d.h`
        <header class="post-header">
            <div>
                <h3 class="post-title" ref="title"></h3>
                <div class="author-name" ref="author"></div>
                <div> ‚óè </div>
                <div class="posted" ref="date"></div>
                <div class="tags" ref="tags"></div>
            </div>
        </header>
        <article class="content" ref="content"></article>
    `.renderCollect(t)}),route("posts",contentDisplay),""!=location.hash&&"#"!=location.hash||(location.hash="posts"),route("post",app.postDisplay),d.run(async()=>{try{await app.loadScriptsThenRunSequentially(!0,"https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.36/dayjs.min.js","https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.36/plugin/utc.min.js","https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.36/plugin/relativeTime.min.js"),window.dayjs.extend(window.dayjs_plugin_utc),window.dayjs.extend(window.dayjs_plugin_relativeTime),dayjs().utcOffset(2),app.emit("dayjsLoaded",app.dayjsLoaded=!0)}catch(t){}});const postNavView=d.html('\n    <nav class="post-nav">\n        <button class="post-back-btn" onclick="location.hash = app.fancyHash || \'posts\'">\n            <span class="icon-left-open"></span>\n            Back to Post List\n        </button>\n    </nav>\n'),quickScroll=d.html('\n<nav class="quick-scroll">\n    <div class="to-top icon-up-open" onclick="window.scrollTo({top: 0, left: 0, behavior: \'smooth\'})">\n    </div>\n    <div class="to-comments icon-comment" onclick="document.querySelector(\'#comments\').scrollIntoView({behavior: \'smooth\'})">\n    </div>\n</nav>');route.on.post(async t=>{await app.afterPostsInitialization();const e=app.activePost=app.posts[t],{title:a,tags:s,author:o,date:n,content:p,comments:i,commentsContainer:c}=app.postDisplay.parts;a.textContent=e.title,n.innerHTML="",d.render(app.renderUXTimestamp(e.posted),n),s.innerHTML="",e.tags.map(t=>df.span({$:s,attr:{title:t},class:"tag"},t)),o.textContent="By "+e.author_name,p.innerHTML="Content loading...",app.commentsDisplay&&df.remove(app.commentsDisplay),df.prepend(mainView,postNavView);const r=await app.fetchPostContent(e.id);p.innerHTML="",e==app.activePost&&(d.render(d.html(r),p),setTimeout(()=>d.queryAll(".content code",p).forEach(t=>{t.classList.add("language-rust")}),60),d.render(quickScroll)),app.emit.postRendered(e,t)}),route.on.change(()=>{location.hash.includes("post:")||df.remove(quickScroll)}),app.votesUI=(t,{id:e,vote:a=0,you_voted:s})=>o=>{const n=div({class:"votes",async onclick(o,n){if(null==app.user){o.preventDefault(),app.oneTimeAuthLauncher.off();try{app.authViewToggle?app.authViewToggle.toggleView():await import("/js/auth.min.js")}catch(o){app.oneTimeAuthLauncher.on()}return}const p=o.target.classList.contains("up"),i=o.target.classList.contains("down");if(!i&&!p)return;o.target.classList.add("await-vote"),clearInterval(n.awaitAnimTimeout),n.awaitAnimTimeout=setTimeout(()=>{o.target.classList.remove("await-vote")},2500);const c=o.target.classList.contains("selected");if(null!=s&&c){const p=await app.vote(t,e);clearInterval(n.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=p&&(n.downvote.classList.remove("selected"),n.upvote.classList.remove("selected"),app.formatVoteCount(n.voteCount,a=p.data),s=null)}else if(p){const p=await app.vote(t,e,!0);clearInterval(n.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=p&&(n.downvote.classList.remove("selected"),n.upvote.classList.add("selected"),app.formatVoteCount(n.voteCount,a=p.data),s=!0)}else if(i){const p=await app.vote(t,e,!1);clearInterval(n.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=p&&(n.upvote.classList.remove("selected"),n.downvote.classList.add("selected"),app.formatVoteCount(n.voteCount,a=p.data),s=!1)}}});return n.append(n.upvote=span({class:{up:!0,vote:!0,selected:!0===s,"icon-up-open":!0}}),n.voteCount=span({class:"vote-count"},a),n.downvote=span({class:{down:!0,vote:!0,selected:!1===s,"icon-down-open":!0}})),n};const publicPost=t=>div({$:postListView,class:"post",attr:{pid:t.id},onclick(e,a){e.target.className.includes("vote")||(location.hash=t.id)}},app.votesUI("writ",t),header(div({class:"title"},h4(t.title),div({class:"author-name"},"By "+t.author_name)),div(div({class:"posted"},app.renderUXTimestamp(t.posted)),div({class:"tags"},t.tags.map(t=>span({class:"tag",attr:{title:t}},t))))));app.formatVoteCount=(t,e,a=2)=>{t.innerHTML="";let s=app.abreviateNum(e,a);if("string"==typeof s&&s.includes(".")){const t=s[s.length-1];s=s.substring(0,s.length-1);const[e,a]=s.split(".");s=[span(e),".",span({class:"endbits"},a),span({class:"marker"},t)]}d.render(s,t)},app.fetchPostContent=async t=>{if(app.posts[t]&&null!=app.posts[t].content)return app.posts[t].content;const e=await fetch("/post-content/"+t),a=await e.json();if(!a.ok)throw new Error(a.status);return app.posts[t].content=a.data},app.posts=Object.create(null),app.postPages=Object.create(null),app.postPaginationView=section({class:"post-pagination"},app.postPageBackBtn=div({class:"page-back",contingentVisibility:"pageNot0",onclick(t){app.fetchPosts(app.activePostPage-1)}},"<<"),app.pageNumView=div({class:"page-num"}),app.postPageForwardBtn=div({class:"page-forward",onclick(t){app.fetchPosts(app.activePostPage+1)}},">>")),app.fetchPosts=async(t=0,e=5)=>{let a;if(d.isArr(app.postPages[t])){postListView.innerHTML="";let a=0;for(const s of app.postPages[t])if(publicPost(app.posts[s]),++a>=e)break}else{try{if(a=await app.writQuery({with_content:!1,kind:"post",amount:e,page:t}),!d.isArr(a))throw console.error(a),new Error(a.status)}catch(t){return app.postPageForwardBtn.style.color="red",app.postPageForwardBtn.textContent="404",void setTimeout(()=>{app.postPageForwardBtn.style.color="",app.postPageForwardBtn.textContent=">>"},3e3)}app.postPages[t]=[],postListView.innerHTML="",a.length>=5&&d.render(app.postPaginationView,contentDisplay),a.forEach(e=>{app.postPages[t].push(e.id),publicPost(app.posts[e.id]=e)})}app.emit.activePostPage(app.activePostPage=t),app.pageNumView.textContent=t,app.cv("pageNot0",0!=t),app.postsInitialized||(app.emit.postsInitialized(app.postsInitialized=!0),app.loadStyle("https://cdnjs.cloudflare.com/ajax/libs/prism/1.21.0/themes/prism-tomorrow.min.css",!0),await import("/js/comments.min.js"))},app.fetchPosts(),app.afterPostsInitialization=t=>app.postsInitialized?null!=t?t():Promise.resolve(!0):null!=t?app.once.postsInitialized(t):new Promise(t=>app.once.postsInitialized(t)),app.dateFormat="HH:mm a DD MMM YYYY",app.dayjsUXTSformat=t=>{const e=dayjs.unix(t).utcOffset(2);return e.format(app.dateFormat)+" | "+e.fromNow()},app.renderUXTimestamp=(t,e=app.dayjsUXTSformat,a)=>{null==a&&(a=d.txt());try{a.textContent=e(t),(a.textContent.includes("minute")||a.textContent.includes("hour"))&&(a.updateInterval=setInterval((function s(){a.textContent=e(t),document.contains(a)?a.textContent.includes("hour")&&(clearInterval(a.updateInterval),a.updateInterval=setInterval(s,36e5)):clearInterval(a.updateInterval)}),6e4))}catch(s){a.textContent=new Date(1e3*t).toLocaleString(),app.once.dayjsLoaded(()=>app.renderUXTimestamp(t,e,a))}return a},app.vote=async(t,e,a)=>{try{const s=await fetch(`/${t}/${e}/${null==a?"unvote":a?"upvote":"downvote"}`);return await s.json()}catch(t){console.error("app.voteWrit error: ",t)}return!1};
//# sourceMappingURL=view.min.js.map